{% block froala_widget %}

<textarea  {{ block( "widget_attributes" ) }}>{{ value }}</textarea>

<!-- Include JQuery -->
{% if includeJQuery %}
<script src="http://code.jquery.com/jquery-1.11.0.js"></script>
{% endif %}

<!-- Include CSS files. -->
<script type="text/javascript">
        function loadCSS( p_path )
        {
        	if ( ! $( "link[href=\"" + p_path + "\"]" ).length )
            {
        		   $( "<link href=\"" + p_path +  "\" rel=\"stylesheet\">" ).appendTo( "head" );
            }
            
//             var $ = document;
//             var head  = $.getElementsByTagName( "head" )[0];
//             var link  = $.createElement( "link" );
//             link.rel  = "stylesheet";
//             link.type = "text/css";
//             link.href = p_path;
//             link.media = "all";
//             head.appendChild( link );
        }  

    	{% if includeFontAwesome %}
            loadCSS( "{{ asset( basePath ~ "css/font-awesome.min.css" ) }}" );
        {% endif %}
        loadCSS( "{{ asset( basePath ~ "css/froala_editor.min.css" ) }}" );
        loadCSS( "{{ asset( basePath ~ "css/froala_style.min.css" ) }}" );
    </script>

<!-- Include JS files. -->
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/froala_editor.min.js" ) }}"></script>
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/langs/" ~ language ~ ".js" ) }}"></script>

<!-- Include license. -->
{% if serialNumber is null %}
<script type="text/javascript">$.Editable.DEFAULTS.key = "{{ serialNumber }}";</script>
{% endif %} {% if usePluginBlockStyles %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/block_styles.min.js" ) }}"></script>
{% endif %} {% if usePluginColors %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/colors.min.js" ) }}"></script>
{% endif %} {% if usePluginCharCounter %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/char_counter.min.js" ) }}"></script>
{% endif %} {% if usePluginFileUpload %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/file_upload.min.js" ) }}"></script>
{% endif %} {% if usePluginFontFamily %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/font_family.min.js" ) }}"></script>
{% endif %} {% if usePluginFontSize %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/font_size.min.js" ) }}"></script>
{% endif %} {% if usePluginFullscreen %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/fullscreen.min.js" ) }}"></script>
{% endif %} {% if usePluginLists %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/lists.min.js" ) }}"></script>
{% endif %} {% if usePluginMediaManager %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/media_manager.min.js" ) }}"></script>
{% endif %} {% if usePluginTables %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/tables.min.js" ) }}"></script>
{% endif %} {% if usePluginUrls %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/urls.min.js" ) }}"></script>
{% endif %} {% if usePluginVideo %}
<script type="text/javascript"
	src="{{ asset( basePath ~ "js/plugins/video.min.js" ) }}"></script>
{% endif %}
<!-- Initialize the editor. -->
<script type="text/javascript">
        function froalaDisplayError( p_message )
        {
            alert( p_message );
        }
        $( document ).ready( function() {
            $( "#{{ id }}" ).editable({

                // Main configuration.
                language : "{{ language }}",

                // Image upload.
                imageUploadURL : "{{ path( imageUploadRoute ) }}",
                imageUploadParams : { path : "{{ imageUploadPath }}", folder : "{{ imageUploadFolder }}" },
                imageDeleteURL : "{{ path( imageUploadRouteDelete ) }}",
                imageDeleteParams : { path : "{{ imageUploadPath }}", folder : "{{ imageUploadFolder }}" },

                // Media manager.
                {% if usePluginMediaManager == true %}
                imagesLoadURL : "{{ path( mediaManagerRoute ) }}",
                imagesLoadParams : { path : "{{ imageUploadPath }}", folder : "{{ imageUploadFolder }}" },
                {% endif %}

                // Autosave.
                {% if autosaveActive == true %}
                autosave : true,
                autosaveInterval : {{ autosaveInterval }},
                saveURL : "{{ path( autosaveRoute, autosaveRouteParams ) }}",
                saveRequestType : "{{ autosaveRequestType }}",
                saveParams : { {% for key, value in autosaveParams %}{{ key }} : "{{ value }}", {% endfor %} },
                {% endif %}

                // Options.
                {% if inlineMode is not null %}
                inlineMode : {{ inlineMode ? "true" : "false" }},
                {% endif %}
                {% if minHeight is not null %}
                minHeight : {{ minHeight }},
                {% endif %}
                {% if maxHeight is not null %}
                maxHeight : {{ maxHeight }},
                {% endif %}
                {% if width is not null %}
                width : {{ width }},
                {% endif %}
                {% if height is not null %}
                height : {{ height }},
                {% endif %}
                {% if plainPaste is not null %}
                plainPaste : {{ plainPaste ? "true" : "false" }},
                {% endif %}
                {% if tabSpaces is not null %}
                tabSpaces : {{ tabSpaces ? "true" : "false" }},
                {% endif %}
                {% if multiLine is not null %}
                multiLine : {{ multiLine ? "true" : "false" }},
                {% endif %}
                {% if paragraphy is not null %}
                paragraphy : {{ paragraphy ? "true" : "false" }},
                {% endif %}
                {% if placeholder is not null %}
                placeholder : "{{ placeholder }}",
                {% endif %}
                {% if theme is not null %}
                theme : "{{ theme }}",
                {% endif %}
                {% if unlinkButton is not null %}
                unlinkButton : {{ unlinkButton ? "true" : "false" }},
                {% endif %}
                {% if beautifyCode is not null %}
                beautifyCode : {{ beautifyCode ? "true" : "false" }},
                {% endif %}
                {% if buttons is not null %}
                buttons : { {% for key, value in buttons %}{{ key }} : "{{ value }}", {% endfor %} },
                {% endif %}
                {% if convertMailAddresses is not null %}
                convertMailAddresses : {{ convertMailAddresses ? "true" : "false" }},
                {% endif %}
                
                
            })
            .on( "editable.afterRemoveImage", function ( e, editor, $img )
            {
                editor.options.imageDeleteParams = { src : $img.attr( "src" ), folder : "{{ imageUploadFolder }}" };
                editor.deleteImage( $img );
            })
            .on( "editable.imageError", function ( e, editor, error )
            {
            	froalaDisplayError( "Error " + error.code + " : " + error.message );
            })
            .on( "editable.imageDeleteError", function ( e, editor, error )
            {
            	froalaDisplayError( "Error " + error.code + " : " + error.message );
            })
            .on( "editable.imagesLoadError", function ( e, editor, error )
            {
            	froalaDisplayError( "Error " + error.code + " : " + error.message );
            })
            .on( "editable.saveError", function ( e, editor, error )
            {
            	froalaDisplayError( "Error " + error.code + " : " + error.message );
            })
            .on( "editable.saveError", function ( e, editor, error )
            {
            	froalaDisplayError( "Error " + error.code + " : " + error.message );
            });
        });
    </script>

{% endblock %}
